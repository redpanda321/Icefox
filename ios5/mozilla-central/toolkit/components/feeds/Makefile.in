#
# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

DEPTH = ../../..
topsrcdir = @top_srcdir@
srcdir = @srcdir@
VPATH = @srcdir@

include $(DEPTH)/config/autoconf.mk

ifdef ENABLE_TESTS
TOOL_DIRS += test
endif

MODULE = feeds
LIBRARY_NAME = feed_s
MOZILLA_INTERNAL_API = 1
FORCE_STATIC_LIB = 1
LIBXUL_LIBRARY = 1

XPIDLSRCS = \
  nsIFeed.idl \
  nsIFeedContainer.idl \
  nsIFeedElementBase.idl \
  nsIFeedEntry.idl \
  nsIFeedGenerator.idl \
  nsIFeedListener.idl \
  nsIFeedPerson.idl \
  nsIFeedProcessor.idl \
  nsIFeedResult.idl \
  nsIFeedTextConstruct.idl \
  $(NULL)

EXTRA_COMPONENTS = FeedProcessor.js FeedProcessor.manifest

include $(topsrcdir)/config/rules.mk

ABS_SRCDIR := $(call core_abspath,$(srcdir))
ifeq ($(OS_ARCH),WINNT)

ABS_DEPTH := $(call core_abspath,$(DEPTH))

check::
	cd $(srcdir)/test; $(LIBXUL_DIST)/bin/xpcshell$(BIN_SUFFIX) shell.js 

else

check::
	$(RUN_TEST_PROGRAM) $(LIBXUL_DIST)/bin/xpcshell$(BIN_SUFFIX) $(srcdir)/test/shell.js $(ABS_SRCDIR)/test

endif # WINNT
