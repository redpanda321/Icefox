# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

DEPTH     = ../..
topsrcdir = @top_srcdir@
srcdir    = @srcdir@
VPATH     = @srcdir@

include $(DEPTH)/config/autoconf.mk

MODULE    = xulrunner

# Statically link against the RTL on windows
USE_STATIC_LIBS = 1
# Don't create a dependency on mozglue
MOZ_GLUE_LDFLAGS =

CPPSRCS   = nsXULStub.cpp

# The value of XULRUNNER_STUB_NAME is generated by configure to allow XULRunner
# apps to override it using the --with-xulrunner-stub-name=<appname> argument.
# If this configure argument is not present then the default name is 'xulrunner'
# for Mac OS X and 'xulrunner-stub' for all other platforms.
PROGRAM   = $(XULRUNNER_STUB_NAME)$(BIN_SUFFIX)

LOCAL_INCLUDES = \
  -I$(topsrcdir)/xpcom/build \
  -I$(topsrcdir)/xpcom/base \
  $(NULL)

DEFINES  += -DXPCOM_GLUE
STL_FLAGS=

LIBS = \
  $(XPCOM_STANDALONE_STATICRUNTIME_GLUE_LDOPTS) \
  $(NULL)

# Need to link with CoreFoundation on Mac
ifeq (cocoa,$(MOZ_WIDGET_TOOLKIT))
LIBS            += \
		$(TK_LIBS) \
		$(NULL)
endif

ifeq ($(OS_ARCH),WINNT)
RCINCLUDE = xulrunner-stub.rc
ifndef GNU_CC
RCFLAGS += -DMOZ_XULRUNNER -I$(srcdir)
else
RCFLAGS += -DMOZ_XULRUNNER --include-dir $(srcdir)
endif
LOCAL_INCLUDES += -I$(topsrcdir)/toolkit/xre
endif

ifndef MOZ_WINCONSOLE
ifdef MOZ_DEBUG
MOZ_WINCONSOLE = 1
else
MOZ_WINCONSOLE = 0
endif
endif

include $(topsrcdir)/config/config.mk

ifdef _MSC_VER
WIN32_EXE_LDFLAGS += -ENTRY:wmainCRTStartup
endif

include $(topsrcdir)/config/rules.mk

ifeq ($(OS_ARCH),WINNT)
OS_LIBS += $(call EXPAND_LIBNAME,shell32)
endif

ifeq (cocoa,$(MOZ_WIDGET_TOOLKIT))

FRAMEWORK_NAME = XUL
FRAMEWORK_VERSION = $(MOZILLA_VERSION)

FRAMEWORK_DIR = \
   $(DIST)/$(FRAMEWORK_NAME).framework/Versions/$(FRAMEWORK_VERSION)

$(FRAMEWORK_DIR):
	$(NSINSTALL) -D $@

$(FRAMEWORK_DIR)/$(PROGRAM): $(PROGRAM) $(FRAMEWORK_DIR)
	$(NSINSTALL) $(PROGRAM) $(FRAMEWORK_DIR)

libs:: $(FRAMEWORK_DIR)/$(PROGRAM)
endif
