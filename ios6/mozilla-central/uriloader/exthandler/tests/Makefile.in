#
# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

DEPTH           = @DEPTH@
topsrcdir       = @top_srcdir@
srcdir          = @srcdir@
VPATH           = @srcdir@
relativesrcdir = @relativesrcdir@

DIRS += mochitest \
        $(NULL)

include $(DEPTH)/config/autoconf.mk

MODULE          = test_uriloader_exthandler

XPCSHELL_TESTS  = unit

#FIXME/bug 575918: out-of-process xpcshell is broken on OS X
ifneq ($(OS_ARCH),Darwin)
XPCSHELL_TESTS += unit_ipc
endif

CPPSRCS =	\
		WriteArgument.cpp \
		$(NULL)

SIMPLE_PROGRAMS = $(CPPSRCS:.cpp=$(BIN_SUFFIX))

include $(topsrcdir)/config/config.mk

LIBS +=		\
		$(NSPR_LIBS) \
		$(NULL)

include $(topsrcdir)/config/rules.mk

ifeq ($(MOZ_WIDGET_TOOLKIT),gtk2)
export PERSONAL_MAILCAP=$(call core_abspath,$(srcdir))/mailcap
endif

# need the executable for running the xpcshell unit tests
ifneq (,$(SIMPLE_PROGRAMS))
libs::
	$(INSTALL) $(SIMPLE_PROGRAMS) $(DEPTH)/_tests/xpcshell/$(relativesrcdir)/unit
endif
